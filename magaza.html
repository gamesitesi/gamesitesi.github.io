<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Premium MaÄŸaza | GameSitesi</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    :root { --bg: #0a0a0a; --card: #121212; --accent: #36d646; --gold: #ffcc00; }
    body { background: var(--bg); color: white; font-family: 'Poppins', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    
    .shop-header { margin-top: 40px; text-align: center; }
    .balance-box { background: var(--card); padding: 10px 20px; border-radius: 50px; border: 1px solid var(--accent); color: var(--accent); font-weight: bold; margin-top: 10px; display: inline-block; }

    /* KATEGORÄ°LER */
    .categories { display: flex; gap: 20px; margin-top: 40px; }
    .cat-card { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #222; cursor: pointer; transition: 0.3s; text-align: center; width: 140px; }
    .cat-card:hover { border-color: var(--accent); transform: translateY(-5px); }
    .cat-card i { font-size: 40px; color: var(--accent); margin-bottom: 15px; }

    /* ÃœRÃœN SLIDER ALANI */
    #shop-display { display: none; flex-direction: column; align-items: center; width: 90%; max-width: 500px; margin-top: 40px; }
    .slider-container { display: flex; align-items: center; justify-content: space-between; background: var(--card); padding: 40px; border-radius: 30px; border: 1px solid #222; width: 100%; box-sizing: border-box; }
    .item-preview { text-align: center; flex: 1; animation: fadeIn 0.5s ease; }
    .item-preview i { font-size: 80px; color: var(--gold); margin-bottom: 15px; display: block; }
    
    .nav-btn { background: none; border: none; color: white; font-size: 25px; cursor: pointer; transition: 0.3s; padding: 10px; }
    .nav-btn:hover { color: var(--accent); }

    .controls { margin-top: 25px; text-align: center; width: 100%; }
    .price-tag { font-size: 24px; color: var(--gold); font-weight: bold; margin-bottom: 15px; display: block; }
    
    .btn-group { display: flex; gap: 10px; justify-content: center; }
    .buy-btn { background: var(--accent); color: black; border: none; padding: 12px 25px; border-radius: 12px; font-weight: bold; cursor: pointer; flex: 1; }
    .try-btn { background: #333; color: white; border: none; padding: 12px 25px; border-radius: 12px; cursor: pointer; flex: 1; }
    
    .back-link { margin-top: 20px; color: #666; cursor: pointer; font-size: 14px; text-decoration: underline; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <div class="shop-header">
    <h1>GameSitesi MaÄŸaza</h1>
    <div id="user-balance" class="balance-box">Bakiye: YÃ¼kleniyor...</div>
  </div>

  <div class="categories" id="cat-list">
    <div class="cat-card" onclick="openCategory('rozet')">
      <i class="fas fa-award"></i>
      <h3>Rozetler</h3>
    </div>
    <div class="cat-card" onclick="openCategory('tema')">
      <i class="fas fa-palette"></i>
      <h3>Temalar</h3>
    </div>
  </div>

  <div id="shop-display">
    <div class="slider-container">
      <button class="nav-btn" onclick="prevItem()"><i class="fas fa-chevron-left"></i></button>
      <div class="item-preview" id="current-item-content">
        </div>
      <button class="nav-btn" onclick="nextItem()"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="controls">
      <span class="price-tag" id="item-price">-- ðŸ’°</span>
      <div class="btn-group">
        <button class="buy-btn" onclick="purchase()">SatÄ±n Al</button>
        <button class="try-btn" onclick="tryItem()">Dene (1 dk)</button>
      </div>
      <div class="back-link" onclick="window.location.reload()">Kategorilere DÃ¶n</div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAlMVSsdR38Mgsa-J07cFSb6ulXWJ3zDxA",
      authDomain: "gamesitesi.firebaseapp.com",
      projectId: "gamesitesi",
      storageBucket: "gamesitesi.appspot.com",
      messagingSenderId: "1:773041885856",
      appId: "1:773041885856:web:b262427b8f31af24bcafc5"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const inventory = {
      rozet: [
        { name: "VIP Rozeti", price: 50, icon: "fa-crown" },
        { name: "Alev Rozeti", price: 100, icon: "fa-fire" },
        { name: "Efsane Elmas", price: 200, icon: "fa-gem" }
      ],
      tema: [
        { name: "Neon YeÅŸil", price: 75, icon: "fa-leaf" },
        { name: "Gece Mavisi", price: 40, icon: "fa-moon" },
        { name: "AltÄ±n Tema", price: 150, icon: "fa-sun" }
      ]
    };

    let selectedItems = [];
    let currentIndex = 0;

    // Bakiye takibi
    auth.onAuthStateChanged(user => {
      if (user) {
        db.collection("users").doc(user.uid).onSnapshot(doc => {
          if (doc.exists) document.getElementById('user-balance').innerText = "Bakiyen: " + (doc.data().coin || 0) + " ðŸ’°";
        });
      }
    });

    function openCategory(type) {
      selectedItems = inventory[type];
      currentIndex = 0;
      document.getElementById('cat-list').style.display = 'none';
      document.getElementById('shop-display').style.display = 'flex';
      updateUI();
    }

    function updateUI() {
      const item = selectedItems[currentIndex];
      const content = document.getElementById('current-item-content');
      content.style.animation = 'none';
      content.offsetHeight; /* animasyonu resetlemek iÃ§in */
      content.style.animation = 'fadeIn 0.5s ease';
      content.innerHTML = `<i class="fas ${item.icon}"></i><h2>${item.name}</h2>`;
      document.getElementById('item-price').innerText = item.price + " ðŸ’°";
    }

    function nextItem() { currentIndex = (currentIndex + 1) % selectedItems.length; updateUI(); }
    function prevItem() { currentIndex = (currentIndex - 1 + selectedItems.length) % selectedItems.length; updateUI(); }

    async function purchase() {
      const user = auth.currentUser;
      if (!user) return alert("GiriÅŸ yapmalÄ±sÄ±n!");

      const item = selectedItems[currentIndex];
      const userRef = db.collection("users").doc(user.uid);
      const snap = await userRef.get();
      const currentCoin = snap.data().coin || 0;

      if (currentCoin < item.price) return alert("Yetersiz bakiye!");

      await userRef.update({
        coin: currentCoin - item.price,
        activeBadge: item.icon // Ä°sminin yanÄ±na bu ikonu ekler
      });

      alert(item.name + " baÅŸarÄ±yla alÄ±ndÄ±! Ana sayfaya yÃ¶nlendiriliyorsun...");
      setTimeout(() => { window.location.href = "index.html"; }, 1500);
    }

    function tryItem() {
      alert("Deneme modu aktif! 1 dakika boyunca bu eÅŸya sende gÃ¶rÃ¼necek.");
      // SessionStorage ile geÃ§ici deneme yapÄ±labilir
    }
  </script>
</body>
</html>